import{K as f,r as c,j as e,L as I,S as U}from"./app-Gh4GXqGQ.js";import{A as F}from"./AuthenticatedLayout-BjcNHJU5.js";import{S as N}from"./sweetalert2.esm.all-B0Dix5B2.js";function q(){const{pendingBookings:v,confirmedBookings:k,cancelledBookings:y}=f().props,[a,S]=c.useState({pending:v,confirmed:k,cancelled:y}),[t,b]=c.useState("pending"),[i,x]=c.useState(!1),[h,o]=c.useState(!1),[m,w]=c.useState(null),[g,C]=c.useState(null),[B,$]=c.useState(null),{flash:d}=f().props;c.useEffect(()=>{d&&d.success&&(B==="confirmed"?N.fire({title:"Success!",text:d.success,icon:"success"}):N.fire({title:"Booking Cancelled",text:d.error||"The booking request has been cancelled.",icon:"error"}))},[d]);const T=(s,n)=>{const l=a.pending.find(r=>r.id===s);if(l){const r=a.pending.filter(_=>_.id!==s);l.status=n;const j=n==="confirmed"?"confirmed":"cancelled";S({...a,pending:r,[j]:[...a[j],l]})}},A=s=>{x(!0),U.put(`/doctor-bookings/${g.id}/status`,{status:s},{preserveScroll:!0,onSuccess:()=>{T(g.id,s),o(!1)},onError:n=>{console.error("Error updating booking status:",n)},onFinish:()=>{x(!1)}})},u=(s,n)=>{$(n),C(s),w(n),o(!0)},L=s=>{switch(s){case"confirmed":return"bg-success";case"cancelled":return"bg-danger";default:return"bg-warning"}},D=s=>{const n=new Date(s),l={year:"numeric",month:"long",day:"numeric"};return n.toLocaleDateString("en-US",l)},E=s=>{const n=new Date().toISOString().split("T")[0],l=new Date(`${n}T${s}`),r={hour:"2-digit",minute:"2-digit",hour12:!0};return l.toLocaleTimeString("en-US",r)},p=s=>e.jsx("div",{className:"card mb-3 shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsx("h5",{className:"card-title mb-0 text-truncate",children:s.patient.name}),e.jsxs("div",{className:"d-flex align-items-center ms-2",children:[e.jsx("span",{className:`badge ${L(s.status)} text-uppercase me-2`,children:s.status}),s.status==="confirmed"&&e.jsxs("a",{href:`/video-call?booking_id=${s.id}&patient_id=${s.patient.id}&recipient=doctor`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-primary d-flex align-items-center",style:{height:"24px"},children:[e.jsx("i",{className:"bi bi-camera-video me-1"}),"Join Call"]})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("p",{className:"card-text mb-2",children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),D(s.appointment.date_start)," ",e.jsx("span",{className:"mx-2",children:"|"}),e.jsx("i",{className:"bi bi-clock me-1",style:{paddingTop:"10px"}}),E(s.selected_time)]}),e.jsxs("p",{className:"card-text mb-2",children:[e.jsx("i",{className:"bi bi-journal me-2"}),"Remarks: ",s.remarks]})]}),s.status==="pending"&&e.jsx("div",{className:"col-md-4 d-flex align-items-center justify-content-end",children:e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{onClick:()=>u(s,"confirmed"),disabled:i,className:"btn btn-success me-2 d-flex align-items-center",children:[i?e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):e.jsx("i",{className:"bi bi-check-circle me-1"}),"Confirm"]}),e.jsxs("button",{onClick:()=>u(s,"cancelled"),disabled:i,className:"btn btn-danger d-flex align-items-center",children:[i?e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})]})})]})]})})})})},s.id);return e.jsxs(F,{header:e.jsx("div",{className:"page-heading",children:e.jsx("h3",{children:"Manage Appointment Bookings"})}),children:[e.jsx(I,{title:"Manage Bookings"}),e.jsx("div",{className:"container py-4",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-xl-12",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsx("div",{className:"card-header bg-white p-4",children:e.jsxs("ul",{className:"nav nav-tabs",id:"bookingsTabs",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${t==="pending"?"active text-warning":""}`,onClick:()=>b("pending"),id:"pending-tab","data-bs-toggle":"tab","data-bs-target":"#pending-tab-pane",type:"button",role:"tab","aria-controls":"pending-tab-pane","aria-selected":t==="pending",children:[e.jsx("i",{className:"bi bi-hourglass-split me-2",style:{color:"black"}}),"Pending",e.jsx("span",{className:"badge bg-warning text-dark ms-2 rounded-pill",children:a.pending.length})]})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${t==="confirmed"?"active text-success":""}`,onClick:()=>b("confirmed"),id:"confirmed-tab","data-bs-toggle":"tab","data-bs-target":"#confirmed-tab-pane",type:"button",role:"tab","aria-controls":"confirmed-tab-pane","aria-selected":t==="confirmed",children:[e.jsx("i",{className:"bi bi-check-circle me-2",style:{color:"black"}}),"Confirmed",e.jsx("span",{className:"badge bg-success ms-2 rounded-pill",children:a.confirmed.length})]})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${t==="cancelled"?"active text-danger":""}`,onClick:()=>b("cancelled"),id:"cancelled-tab","data-bs-toggle":"tab","data-bs-target":"#cancelled-tab-pane",type:"button",role:"tab","aria-controls":"cancelled-tab-pane","aria-selected":t==="cancelled",children:[e.jsx("i",{className:"bi bi-x-circle me-2",style:{color:"black"}}),"Cancelled",e.jsx("span",{className:"badge bg-danger ms-2 rounded-pill",children:a.cancelled.length})]})})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"tab-content",id:"bookingsTabsContent",children:[e.jsx("div",{className:`tab-pane fade ${t==="pending"?"show active":""}`,id:"pending-tab-pane",role:"tabpanel","aria-labelledby":"pending-tab",tabIndex:"0",children:a.pending.length>0?a.pending.map(s=>p(s)):e.jsxs("div",{className:"text-center py-5 text-muted",children:[e.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),e.jsx("p",{children:"No pending bookings"})]})}),e.jsx("div",{className:`tab-pane fade ${t==="confirmed"?"show active":""}`,id:"confirmed-tab-pane",role:"tabpanel","aria-labelledby":"confirmed-tab",tabIndex:"0",children:a.confirmed.length>0?a.confirmed.map(s=>p(s)):e.jsxs("div",{className:"text-center py-5 text-muted",children:[e.jsx("i",{className:"bi bi-calendar-check fs-1 d-block mb-2"}),e.jsx("p",{children:"No confirmed bookings"})]})}),e.jsx("div",{className:`tab-pane fade ${t==="cancelled"?"show active":""}`,id:"cancelled-tab-pane",role:"tabpanel","aria-labelledby":"cancelled-tab",tabIndex:"0",children:a.cancelled.length>0?a.cancelled.map(s=>p(s)):e.jsxs("div",{className:"text-center py-5 text-muted",children:[e.jsx("i",{className:"bi bi-calendar-x fs-1 d-block mb-2"}),e.jsx("p",{children:"No cancelled bookings"})]})})]})})]})})})}),h&&e.jsx("div",{className:"modal fade show",style:{display:"block"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Confirm Booking Status"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>o(!1),disabled:i})]}),e.jsx("div",{className:"modal-body",children:m==="confirmed"?e.jsxs(e.Fragment,{children:["Are you sure you want to ",e.jsx("strong",{children:"confirm"})," this appointment?"]}):e.jsxs(e.Fragment,{children:["Are you sure you want to ",e.jsx("strong",{children:"cancel"})," this appointment?"]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>o(!1),disabled:i,children:"Close"}),e.jsxs("button",{type:"button",className:`btn ${m==="confirmed"?"btn-success":"btn-danger"}`,onClick:()=>A(m),disabled:i,children:[i?e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):null,m==="confirmed"?"Confirm Appointment":"Cancel Appointment"]})]})]})})}),h&&e.jsx("div",{className:"modal-backdrop fade show"})]})}export{q as default};
